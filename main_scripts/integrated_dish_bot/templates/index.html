<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dish Bot - Live Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00ff00;
        }

        h1 {
            color: #00ff00;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1em;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav a {
            color: #00ff00;
            text-decoration: none;
            padding: 10px 20px;
            background-color: #2a2a2a;
            border-radius: 5px;
            border: 1px solid #00ff00;
            transition: all 0.3s;
        }

        .nav a:hover {
            background-color: #00ff00;
            color: #1a1a1a;
        }

        .video-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .video-feed {
            max-width: 100%;
            border: 3px solid #00ff00;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .info-card h3 {
            color: #00ff00;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-card p {
            color: #ccc;
            line-height: 1.6;
        }

        .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 5px;
            text-align: center;
        }

        .legend-item {
            display: inline-block;
            margin: 0 15px;
            color: #ccc;
        }

        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
            border: 2px solid #fff;
        }

        .color-green { background-color: #00ff00; }
        .color-yellow { background-color: #ffff00; }
        .color-orange { background-color: #ffa500; }
        .color-red { background-color: #ff0000; }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #666;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Dish Bot - Live Monitoring</h1>
            <p class="subtitle">Dual Camera Dish Detection & Face Recognition System</p>
        </header>

        <nav class="nav">
            <a href="/">üé• Live Feed</a>
            <a href="/history">üìú History</a>
            <a href="/api/recent_events" target="_blank">üìä API</a>
        </nav>

        <div class="video-container">
            <img src="{{ url_for('video_feed') }}" alt="Live Feed" class="video-feed">
        </div>

        <div class="legend">
            <h4 style="color: #00ff00; margin-bottom: 10px;">Dish Detection Status Legend:</h4>
            <div class="legend-item">
                <span class="legend-color color-green"></span>
                <span>Tracked (Associated)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color color-yellow"></span>
                <span>Stationary (Waiting)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color color-orange"></span>
                <span>Ready for Association (15s+)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #0000ff;"></span>
                <span>Moving</span>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h3>üì∏ Left Feed: Dish Detection</h3>
                <p>
                    YOLO model detects dishes placed in the sink.
                    Each dish is assigned a unique ID and tracked over time.
                    Dishes must remain stationary for 15 seconds before face association triggers.
                </p>
            </div>

            <div class="info-card">
                <h3>üë§ Right Feed: Face Recognition</h3>
                <p>
                    OpenCV LBPH face recognition identifies people near the sink.
                    When a new dish is detected, faces are captured in a 3-second window
                    (1s before to 2s after detection).
                </p>
            </div>

            <div class="info-card">
                <h3>üîó Association Logic</h3>
                <p>
                    When a dish remains stationary for 15 seconds, the system analyzes
                    collected face data and associates the dish with the closest person
                    (largest face in frame). Results are saved to database with snapshots.
                </p>
            </div>

            <div class="info-card">
                <h3>üíæ Data Storage</h3>
                <p>
                    All detection events are stored in SQLite database with timestamps,
                    person names, confidence scores, and photo evidence. Media files
                    are automatically cleaned up after 7 days.
                </p>
            </div>
        </div>

        <footer>
            <p>Integrated Dish Bot v1.0 | Built with Flask, YOLO, and OpenCV</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                Running on Raspberry Pi 4 | Dual Camera System
            </p>
        </footer>
    </div>
</body>
</html>
